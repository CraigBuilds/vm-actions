#cloud-config
# Install and configure doas for Alpine Linux
packages:
  - doas

write_files:
  - path: /etc/doas.conf
    content: |
      permit nopass :wheel
      permit nopass ${username}
    permissions: '0600'

users:
  - name: ${username}
    groups: [sudo, wheel]
    shell: /bin/bash
    sudo: ['ALL=(ALL) NOPASSWD:ALL']
    lock_passwd: false%{ if password != "" }
    passwd: ${password}%{ endif }
    %{ if ssh_public_key != "" }
    ssh_authorized_keys:
      - ${ssh_public_key}%{ endif }

# Set hostname
hostname: ${hostname}
manage_etc_hosts: true

# Configure SSH
ssh_pwauth: true
disable_root: false
