#cloud-config
# Install and configure doas for Alpine Linux
packages:
  - doas

write_files:
  - path: /etc/doas.conf
    content: |
      permit nopass :wheel
    permissions: '0600'
  - path: /etc/sudoers.d/90-cloud-init-users
    content: |
      # Created by cloud-init for passwordless sudo
      %sudo ALL=(ALL) NOPASSWD:ALL
    permissions: '0440'

users:
  - name: ${username}
    groups: [${user_groups}]
    shell: /bin/bash
    lock_passwd: false%{ if password != "" }
    passwd: ${password}%{ endif }
    %{ if ssh_public_key != "" }
    ssh_authorized_keys:
      - ${ssh_public_key}%{ endif }
    sudo: ALL=(ALL) NOPASSWD:ALL

# Set hostname
hostname: ${hostname}
manage_etc_hosts: true

# Configure SSH
ssh_pwauth: true
disable_root: false
