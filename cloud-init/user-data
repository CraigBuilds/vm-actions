#cloud-config

packages:
%{ for pkg in split(",", cloud_init_packages) ~}
  - ${trimspace(pkg)}
%{ endfor ~}

users:
  - name: ${username}
    groups: [${user_groups}]
    shell: /bin/bash
    ssh_authorized_keys:
      - ${ssh_public_key}

write_files:
  - path: /etc/doas.conf
    content: |
      permit nopass :wheel
    permissions: '0600'
  - path: /etc/sudoers.d/90-cloud-init-users
    content: |
      %sudo ALL=(ALL) NOPASSWD:ALL
    permissions: '0440'

hostname: ${hostname}

ssh_pwauth: true
disable_root: false
